var req,emailResult;function sendEmailToMyReps(){req=newXMLHttpRequest();req.onreadystatechange=handlerFunction(req,"compose");req.open("POST","OEGAdminBizClients",true);req.setRequestHeader("Content-Type","application/x-www-form-urlencoded");var url="actionToPerform=sendEmailToMyReps";req.send(url);}
function startInvite(){document.taskDelegationForm.action="OEGInvite";document.taskDelegationForm.actionToPerform.value="startInvite";document.taskDelegationForm.submit();}
function startInviteForm(){document.taskDelegationProcessForm.action="OEGInvite";document.taskDelegationProcessForm.actionToPerform.value="startInviteProcess";document.taskDelegationProcessForm.submit();}
function newXMLHttpRequest(){var xmlreq=false;if(window.XMLHttpRequest){xmlreq=new XMLHttpRequest();}else if(window.ActiveXObject){try{xmlreq=new ActiveXObject("Msxml2.XMLHTTP");}catch(e1){alert("Exception occurred...");try{xmlreq=new ActiveXObject("Microsoft.XMLHTTP");}catch(e2){}}}
return xmlreq;}
function handlerFunction(req,displayType){return function(){if(req.readyState==4){if(req.status==200){var browserName="";var ua=navigator.userAgent.toLowerCase();if(ua.indexOf("opera")!=-1){browserName="opera";}else if(ua.indexOf("msie")!=-1){browserName="msie";}else if(ua.indexOf("safari")!=-1){browserName="safari";}else if(ua.indexOf("mozilla")!=-1){if(ua.indexOf("firefox")!=-1){browserName="firefox";}else{browserName="mozilla";}}
if(browserName=="msie"){var enterprises=req.responseXML.getElementsByTagName("enterprises")[0];if(enterprises!=null){openEmailwindow(req.responseXML,displayType);}else{Ext.MessageBox.alert('Status','You Session has Timed out. Please log on to the my New Jersey Portal to access Premier Business Services.');}}else{var responseXML=req.responseXML;if(responseXML!=null){openEmailwindow(req.responseXML,displayType);}else{Ext.MessageBox.alert('Status','You Session has Timed out. Please log on to the my New Jersey Portal to access Premier Business Services.');}}}else{}}}}
var combo='';function responseXmlHandler(responseXML){var enterprises=responseXML.getElementsByTagName("enterprises")[0];for(loop=0;loop<enterprises.childNodes.length;loop++){var entp=enterprises.childNodes[loop];var enterprise=entp.getElementsByTagName("enterprise")[0];combo=combo+'<option value='+enterprise.childNodes[0].nodeValue+'>'+enterprise.childNodes[0].nodeValue+'</option>';}
var oCombo='<select class="textsmall" Name="buzName">';oCombo=oCombo+'<option value="" selected>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- Business Name ---&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</option>';combo=oCombo+combo+'</select>';}
function newwindow(){var ww=875;var wh=625;var params='width='+ww+',height='+wh+',scrollbars,resizable';var msg='<html><head><title>Invite Your Representative</title></head><body><h3 aligh="center">Title comes here...</h3>';msg=msg+'<table border="0" align="center" width="100%" cellpadding="0" cellspacing="3">';msg=msg+'<tr>';msg=msg+'<br>';msg=msg+'<td colspan="3" class="textsmall">';msg=msg+'<br>';msg=msg+'<div align="LEFT">';msg=msg+'Enter the email address and name of the person you wish to designate as an Authorized Representative to perform tasks on behalf of your business or businesses, and click Send Invitation. Your invitation will be sent to the designee';msg=msg+'along with instructions explaining  how to obtain a myNewJersey Portal user ID. The designee will be instructed to provide you with his/her Portal user ID. You may assign tasks to the designee only after you have received his/her user ID. ';msg=msg+'</div>';msg=msg+'</td>';msg=msg+'</tr>';msg=msg+'<tr><td colspan="3">';msg=msg+'<BR><BR>';msg=msg+'&nbsp;</td></tr>';msg=msg+'<tr><td class="textsmall" align = "Right" width ="17%">';msg=msg+'Business Name:';msg=msg+'</td>';msg=msg+'<td class="textsmall" width="60%">'+combo;msg=msg+'<FONT color="RED">*</FONT>&nbsp;&nbsp;';msg=msg+'<img src="/eBiz/images/help.gif" alt="Select the Business Name for which you want to send an Email Invitation" onClick="selectBiztoInviteClientMessage()">';msg=msg+'</td></tr>';msg=msg+'<tr><td class="textsmall" align = "Right" width ="17%">';msg=msg+'Contact Name:';msg=msg+'</td>';msg=msg+'<td align="LEFT" class="textsmall" width="60%">';msg=msg+'<input type ="text" name="contactName" size="33">';msg=msg+'<FONT color="RED">*</FONT>';msg=msg+'</td>';msg=msg+'</tr>';msg=msg+'<tr>';msg=msg+'<td class="textsmall" align = "RIGHT" width ="17%">';msg=msg+'Email address:';msg=msg+'</td>';msg=msg+'<td align="LEFT" class="textsmall" width="60%">';msg=msg+'<input type ="text" name="emailAddress" size="33">';msg=msg+'<FONT color="RED">*</FONT>';msg=msg+'</td>';msg=msg+'</tr>';msg=msg+'</table>';msg=msg+'<div align="center"><br><hr width="100%" size="1"><form><input type="button" onclick="javascript:window.close();" value="Close window"><br><hr width="100%" size="1"></form></div></body></html>';var win=open('','',params);win.document.write("<link rel='stylesheet' type='text/css' href='/nj/eBiz/css/default.css'>");win.document.write("<link rel='stylesheet' type='text/css' href='/nj/eBiz/css/ext-all.css'>");win.document.write("<link rel='stylesheet' type='text/css' href='/nj/eBiz/css/examples.css'>");win.document.write("<script type='text/javascript' language='javascript' src='/nj/eBiz/javaScript/viewUserDetail.js'></script>");combo='';win.document.write(msg);win.document.close();}
var emailwin;function openEmailwindow(responseXML,displayType){if(displayType=='postCompose'){}
var enterprises=responseXML.getElementsByTagName("enterprises")[0];Ext.namespace('Ext.exampledata');var anewCombo=[];var biz;for(loop=0;loop<enterprises.childNodes.length;loop++){var entp=enterprises.childNodes[loop];var enterprise=entp.getElementsByTagName("enterprise")[0];newCombo=[enterprise.childNodes[0].nodeValue,enterprise.childNodes[0].nodeValue];anewCombo[loop]=newCombo;}
Ext.exampledata.states=anewCombo;var store=new Ext.data.SimpleStore({fields:['abbr','state'],data:Ext.exampledata.states});if(!emailwin){emailwin=new Ext.Window({layout:'fit',width:500,height:500,el:'hello-win',title:'Invite Representative to My Business',collapsible:true,closeAction:'hide',autoWidth:false,autoHeight:false,resizable:false,plain:true,stateful:true,items:new Ext.FormPanel({labelAlign:'top',frame:true,bodyStyle:'padding:5px 5px 0',width:600,items:[{layout:'column',items:[{columnWidth:.90,layout:'form',items:[{xtype:'panel',contentEl:'hello-tabs',border:false}]},{columnWidth:.90,layout:'form',items:[{xtype:'textfield',fieldLabel:'Representative Name',id:'repsName',name:'first',anchor:'100%'}]},{columnWidth:.90,layout:'form',items:[{xtype:'textfield',fieldLabel:'Representative Email Address',id:'Email',name:'email',vtype:'email',anchor:'100%'}]},{columnWidth:.90,layout:'form',items:[{xtype:'combo',store:store,fieldLabel:'Your Business Name',displayField:'state',typeAhead:false,editable:false,mode:'local',triggerAction:'all',emptyText:'Select Business Name',anchor:'100%',id:'businessName',selectOnFocus:true}]}]}],buttons:[{text:'Send Invitation',handler:function(){var clientEmail=Ext.getCmp('Email');var contactName=Ext.getCmp('repsName');var bizName=Ext.getCmp('businessName');var booValidation=validateParams(clientEmail.getValue(),contactName.getValue(),bizName.getValue());if(booValidation){if(sendemail(clientEmail.getValue(),contactName.getValue(),bizName.getValue())){Ext.MessageBox.alert('Status','Your request has not ...been sent to your authorized representative');}else{Ext.MessageBox.alert('Status','Your request has been sent to your authorized representative');}}else{}}},{text:'Cancel',handler:function(){emailwin.setVisible(false);}}]})});emailwin.show();}else{emailwin.setVisible(true);emailwin.toggleCollapse(false);emailwin.toggleCollapse(true);}
if(!emailwin){}else{var repname=Ext.getCmp('repsName');repname.setValue('');var bizname=Ext.getCmp('businessName');bizname.setValue('');var email=Ext.getCmp('Email');email.setValue('');}}
function validateParams(clientEmail,firstName,businessName){var error=0;var errorMessage=[];var errorArray=[];if(firstName.length==0){error++;errorArray[error]="Provide your Representative name whom you are inviting";}
if(clientEmail.length==0){error++;errorArray[error]="Valid email address is required.";}
function isEmail(s){pattern=/\b.+@.+\..+\b/;return pattern.test(s);}
if(clientEmail.length!=0){if(!isEmail(clientEmail)){error++
errorArray[error]="Valid E-Mail Address is required.";}}
if(businessName.length==0){error++;errorArray[error]="Business name can not be empty.";}
if(error>0){if(error>1){errorMessage+="<TABLE> <TR><TD><FONT COLOR='BLUE' FACE=Verdana SIZE=2><U>";errorMessage+="Please ensure the following required elements have been provided:";errorMessage+="</TD></TR></U>";errorMessage+="<TR><TD>&nbsp;</TD></TR>";}
for(var i=1;i<=error;i++){errorMessage+="<TR><TD><FONT FACE=Verdana SIZE=2>";errorMessage+=errorArray[i];errorMessage+="</TD></TR>";}
if(error>1){errorMessage+="<TR><TD>&nbsp;</TD></TR>";errorMessage+="<TR><TD><FONT FACE=Verdana SIZE=2>";errorMessage+="Please insert appropriate values and re-submit your request.";errorMessage+="</TD></TR>";}
errorMessage+="</TABLE>";Ext.Msg.show({title:'Error ',msg:errorMessage,buttons:Ext.Msg.OK,minWidth:300,animEl:'elId',icon:Ext.MessageBox.ERROR});return false;}
else{return true;}}
function validateInputParams(){var firstName=document.portalRegiForm.contactName.value;var clientEmail=document.portalRegiForm.emailAddress.value;var clientEmail1=document.portalRegiForm.emailAddress1.value;var businessName=document.portalRegiForm.businessName.value;var error=0;var errorMessage=[];var errorArray=[];if(firstName.length==0){error++;errorArray[error]="Provide your Representative name whom you are inviting";}
if(clientEmail.length==0){error++;errorArray[error]="Valid email address is required.";}
if(clientEmail1.length==0){error++;errorArray[error]="Valid verify email address is required.";}
function isEmail(s){pattern=/\b.+@.+\..+\b/;return pattern.test(s);}
if(clientEmail.length!=0){if(!isEmail(clientEmail)){error++
errorArray[error]="Valid E-Mail Address is required.";}}
if(clientEmail1.length!=0){if(!isEmail(clientEmail1)){error++
errorArray[error]="Valid verify E-Mail Address is required.";}}
if(clientEmail!=clientEmail1){error++
errorArray[error]="Both emails should have same value.";}
if(businessName.length==0){error++;errorArray[error]="Business name can not be empty.";}
if(error>0){if(error>1){errorMessage+="<TABLE> <TR><TD><FONT COLOR='BLUE' FACE=Verdana SIZE=2><U>";errorMessage+="Please ensure the following required elements have been provided:";errorMessage+="</TD></TR></U>";errorMessage+="<TR><TD>&nbsp;</TD></TR>";}
for(var i=1;i<=error;i++){errorMessage+="<TR><TD><FONT FACE=Verdana SIZE=2>";errorMessage+=errorArray[i];errorMessage+="</TD></TR>";}
if(error>1){errorMessage+="<TR><TD>&nbsp;</TD></TR>";errorMessage+="<TR><TD><FONT FACE=Verdana SIZE=2>";errorMessage+="Please insert appropriate values and re-submit your request.";errorMessage+="</TD></TR>";}
errorMessage+="</TABLE>";Ext.Msg.show({title:'Error ',msg:errorMessage,buttons:Ext.Msg.OK,minWidth:300,animEl:'elId',icon:Ext.MessageBox.ERROR});return false;}
else{document.portalRegiForm.action="OEGAdminBizClients";document.portalRegiForm.actionToPerform.value="sendEmailRequestToMyReps";document.portalRegiForm.submit();return true;}}
function sendemail(clientEmail,repsName,businessName){var req=newXMLHttpRequestForEmail();req.open("POST","OEGAdminBizClients",true);req.setRequestHeader("Content-Type","application/x-www-form-urlencoded");var url="actionToPerform=sendEmailRequestToMyReps&emailAddress="+clientEmail+"&contactName="+repsName+"&buzName="+businessName;req.send(url);}
function emailHandlerFunction(req,displayType){return function(){if(req.readyState==4){if(req.status==200){var emailStatus=req.responseXML.getElementsByTagName("emailStatus")[0];if(emailStatus!=null){for(loop=0;loop<emailStatus.childNodes.length;loop++){var status=emailStatus.childNodes[loop];var result=status.getElementsByTagName("result")[0];emailResult=result.childNodes[0].nodeValue;}}}else{}}}}
function newXMLHttpRequestForEmail(){var xmlreq=false;if(window.XMLHttpRequest){xmlreq=new XMLHttpRequest();}else if(window.ActiveXObject){try{xmlreq=new ActiveXObject("Msxml2.XMLHTTP");}catch(e1){alert("Exception occurred...");try{xmlreq=new ActiveXObject("Microsoft.XMLHTTP");}catch(e2){}}}
return xmlreq;}